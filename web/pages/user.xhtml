<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition template="/layout/template.xhtml">
        <ui:define name="page_title">
            User Detail
        </ui:define>
        <ui:define name="layout_content">
            <p:layoutUnit id="pnlCenter" position="center">
                <h:form id="form_main"> 
                    <div>
                        <p:messages id="pmessages" showDetail="true" showSummary="false"  closable="true" /> 
                    </div>
                    <div>
                        <p:panel id="pnlCommand"  >
                            <div style="text-align: right">
                                <p:commandButton id="btnAdd" process="@this" value="Thêm " actionListener="#{userController.addUser}" icon="ui-icon ui-icon-circle-plus" 
                                                 update="pnlAdd,pnlList,pnlCommand,pmessages" rendered="#{userController.mbView eq true}"  /> 
                                <p:commandButton id="btnBack" process="@this" styleClass="back" icon="ui-icon-circle-triangle-w"  value="Quay lại"  rendered="#{userController.mbView eq false}" 
                                                 update="pnlAdd,pnlList,pnlCommand" actionListener="#{userController.backUser}" />
                                <p:commandButton id="btnSave" process="@this,pnlAdd"  value="Ghi "  icon="ui-icon-disk" rendered="#{userController.mbView eq false}"  
                                                 update="pnlAdd,pnlList,pnlCommand,pmessages" actionListener="#{userController.saveUser}" />   
                                <p:commandButton id="btnDelete"  process="@this" value="Xóa "  icon="ui-icon-trash" rendered="#{userController.mbView}" 
                                                 oncomplete="cfmDeleteN.show();"  disabled="#{userController.mlistUserSelected[0] eq null}"   
                                                 update="pnlList,pnlCommand"  />                   
                            </div>
                        </p:panel>
                        <p:panel id="pnlList" header="Danh sách người dùng" visible="#{userController.mbView}">
                            <div style="overflow: auto">
                                <p:dataTable id="dtUser"  value="#{userController.mlistUser}" var="user"
                                             rowKey="#{user.userId}" style="width: 100%"   filteredValue="#{userController.mlistUserFilter}"
                                             paginator="true"  selection="#{userController.mlistUserSelected}" 
                                             rows="20"  paginatorPosition="bottom"
                                             rowsPerPageTemplate="10,20,30" 
                                             widgetVar="widgetUser"
                                             emptyMessage="Empty">
                                    <p:ajax event="rowSelectCheckbox"   update=":form_main:pnlCommand" />
                                    <p:ajax event="rowUnselectCheckbox"  update=":form_main:pnlCommand"/>  
                                    <p:ajax event="toggleSelect" update=":form_main:pnlCommand" />
                                    <f:facet name="header">  
                                        <p:outputPanel>  
                                            <h:outputText value="Tìm tất cả " />  
                                            <p:inputText id="globalFilter" onkeyup="widgetUser.filter()" style="width:150px" />  
                                        </p:outputPanel>  
                                    </f:facet>                             
                                    <p:column selectionMode="multiple" style="width:2%" />
                                    <p:column headerText="Tên ĐN" filterMatchMode="contains" filterBy="#{user.userName}" sortBy="#{user.userName}" >  
                                        <h:outputText value=" #{user.userName}">
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Người dùng" filterMatchMode="contains" filterBy="#{user.fullName}" sortBy="#{user.fullName}" >  
                                        <h:outputText value=" #{user.fullName}">
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Ngày sinh" filterMatchMode="contains" filterBy="#{user.birthDay}" sortBy="#{user.birthDay}" >  
                                        <h:outputText value="#{user.birthDay}">
                                            <f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT+7" />
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Email " filterMatchMode="contains" filterBy="#{user.email}" sortBy="#{user.email}" >  
                                        <h:outputText value="#{user.email}">
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Mức lương" filterMatchMode="contains" filterBy="#{user.salary}" sortBy="#{user.salary}" >  
                                        <h:outputText value="#{user.salary}">
                                            <f:convertNumber pattern="###,###"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Trạng thái" filterMatchMode="contains" filterBy="#{user.status}" sortBy="#{user.status}" >  
                                        <h:outputText value=" #{user.status}">
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Thao tác"  style="text-align: center;"  >
                                        <p:commandLink id="cmdEdit" process="@this"  title="Sửa " value="Sửa " style="font-weight: bold;color: red"
                                                       actionListener="#{userController.editUser(user)}" update=":form_main:pnlList,:form_main:pnlAdd,:form_main:pnlCommand" > 
                                        </p:commandLink> ||
                                        <p:commandLink id="cmdDelete"  process="@this" title="Xóa " value="Xóa " style="font-weight: bold;color: red"
                                                       actionListener="#{userController.preDeleteUser(user)}" oncomplete="cfmDelete.show();" >  
                                        </p:commandLink>
                                    </p:column>     
                                </p:dataTable>
                            </div>
                        </p:panel>
                        <p:panel id="pnlAdd" header="Thêm người dùng" visible="#{!userController.mbView}" >
                            <p:panelGrid  style="width: 100%" rendered="#{userController.muser!=null}">
                                <p:row>
                                    <p:column style="width: 15%;">
                                        <p:outputLabel value="Tên ĐN" for="txtUserName"/>
                                    </p:column>
                                    <p:column style="width: 85%;">
                                        <p:inputText id="txtUserName" value="#{userController.muser.userName}" 
                                                     required="true" requiredMessage="Nhập Tên ĐN"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column style="width: 15%;">
                                        <p:outputLabel value="Họ tên " for="txtFullName"/>
                                    </p:column>
                                    <p:column style="width: 85%;">
                                        <p:inputText id="txtFullName" value="#{userController.muser.fullName}" 
                                                     required="true" requiredMessage="Nhập họ tên"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column style="width: 15%;">
                                        <p:outputLabel value="Ngày sinh" for="calBirthDay"/>
                                    </p:column>
                                    <p:column style="width: 85%;">
                                        <p:calendar  pattern="dd/MM/yyyy" value="#{userController.muser.birthDay}"
                                                     id="calBirthDay" styleClass="hasDatepicker" mode="popup" navigator="true"
                                                     required="true" requiredMessage="Nhập ngày sinh">
                                            <f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT+7" />
                                        </p:calendar>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column style="width: 15%;">
                                        <p:outputLabel value="Email " for="txtEmail"/>
                                    </p:column>
                                    <p:column style="width: 85%;">
                                        <p:inputText id="txtEmail" value="#{userController.muser.email}" 
                                                     required="true" requiredMessage="Nhập Email"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column style="width: 15%;">
                                        <p:outputLabel value="Password " for="txtPassword"/>
                                    </p:column>
                                    <p:column style="width: 85%;">
                                        <p:password id="txtPassword" value="#{userController.muser.password}"  required="true" requiredMessage="Nhập mật khẩu"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column style="width: 15%;">
                                        <p:outputLabel value="Mức lương" for="txtSalary"/>
                                    </p:column>
                                    <p:column style="width: 85%;">
                                        <p:inputText id="txtSalary" value="#{userController.muser.salary}" 
                                                     required="true" requiredMessage="Nhập mức lương"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column style="width: 15%;">
                                        <p:outputLabel value="Trạng thái" for="sobStatus"/>
                                    </p:column>
                                    <p:column style="width: 85%;">
                                        <p:selectOneButton id="sobStatus" value="#{userController.muser.status}">
                                            <f:selectItem itemLabel="Active" itemValue="1" />  
                                            <f:selectItem itemLabel="Passive" itemValue="0" />  
                                        </p:selectOneButton>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column style="width: 15%;">
                                        <p:outputLabel value="Quyền" for="cboRole"/>
                                    </p:column>
                                    <p:column style="width: 85%;">
                                        <p:selectOneMenu id="cboRole"  value="#{userController.muser.roleId}"
                                                         effect="fade" required="true" requiredMessage="Chọn quyền" >                                                                            
                                            <f:selectItems value="#{userController.mlistRole}" var="role" itemLabel="#{role.roleName}" itemValue="#{role.roleID}"/>
                                        </p:selectOneMenu>
                                    </p:column>
                                </p:row>
                            </p:panelGrid>
                        </p:panel>
                    </div>
                    <p:confirmDialog message="Bạn có muốn xóa dữ liệu?" header="Xóa dữ liệu" appendTo="@(body)" id="cfmDelete" 
                                     severity="alert"
                                     widgetVar="cfmDelete">
                        <p:commandButton value="Có "  process="@this"  actionListener="#{userController.deleteUser}" 
                                         update="pnlList,pmessages" 
                                         oncomplete="cfmDelete.hide();"/>
                        <p:commandButton value="Không " onclick="cfmDelete.hide();" type="button" />
                    </p:confirmDialog>
                    <p:confirmDialog message="Bạn có muốn xóa dữ liệu?" header="Xóa dữ liệu" appendTo="@(body)" id="cfmDeleteN" 
                                     severity="alert"
                                     widgetVar="cfmDeleteN">
                        <p:commandButton value="Có "  process="@this"  actionListener="#{userController.deleteAllUser}" 
                                         update="pnlList,pmessages,pnlCommand" 
                                         oncomplete="cfmDeleteN.hide();"/>
                        <p:commandButton value="Không " onclick="cfmDeleteN.hide();" type="button" />
                    </p:confirmDialog>
                </h:form>
            </p:layoutUnit>
        </ui:define>
    </ui:composition>
</html>

